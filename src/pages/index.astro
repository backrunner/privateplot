---
import { ArticleList } from '../components/business/ArticleList';
import Page from '../components/layout/Page.astro';
import { ArticleService } from '../services/ArticleService';

const ITEMS_PER_PAGE = 10;
const articleService = new ArticleService(Astro.locals.runtime.env.DB);
const articles = await articleService.list();
const sortedArticles = articles.sort((a, b) =>
  new Date(b.createdDate).getTime() - new Date(a.createdDate).getTime()
);

const initialArticles = sortedArticles.slice(0, ITEMS_PER_PAGE).map(({ id, title, summary, createdDate, updatedDate, slug }) => ({
  id,
  title,
  summary,
  createdDate,
  updatedDate,
  slug,
}));

const hasMore = articles.length > ITEMS_PER_PAGE;
const total = articles.length;
---

<Page>
	<ArticleList client:load initialArticles={initialArticles} initialHasMore={hasMore} total={total} />
</Page>
