---
import { undefined } from 'astro:schema';
import { ArticleList } from '../components/business/ArticleList';
import Page from '../components/layout/Page.astro';
import { getCollection } from 'astro:content';

const ITEMS_PER_PAGE = 10;
const articles = await getCollection('article');
const sortedArticles = articles.sort((a, b) => b.data.createdDate.getTime() - a.data.createdDate.getTime());
const initialArticles = sortedArticles.slice(0, ITEMS_PER_PAGE).map(article => ({
  id: article.id,
  title: article.data.title,
  summary: article.data.summary || article.body?.slice(0, 200) + '...',
  createdAt: article.data.createdDate,
  updatedAt: article.data.updatedDate,
  slug: article.id,
}));

const hasMore = articles.length > ITEMS_PER_PAGE;
const total = articles.length;
---

<Page>
	<ArticleList client:load initialArticles={initialArticles} initialHasMore={hasMore} total={total} />
</Page>
